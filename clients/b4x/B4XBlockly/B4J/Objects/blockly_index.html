<!DOCTYPE html>
<html>
<!-- 
	Project:	HomeKit32
	File:		blockly_index.html.
	Brief:		Blockly example for the HomeKit32 (HK32) project.
	Date:		20251211
	Author:		Robert W.B. Linn (c) 2025 MIT
-->

<head>
<meta charset="utf-8">
<title>Blockly HomeKit32</title>

<!-- Core Blockly (use the version you prefer) -->
<script src="https://unpkg.com/blockly@8.0.0/blockly.min.js"></script>

<style>
  html, body { height: 100%; margin: 0; }
  #blocklyDiv { height: calc(100% - 40px); width: 100%; }
  #buttons { height: 40px; padding: 6px; background: #f4f4f4; box-sizing: border-box; }
  button { margin-right: 6px; }
</style>
</head>
<body>

<!-- 
	Toolbox: categories / blocks shown in the sidebar 
-->
<xml id="toolbox" style="display:none">

	<!--
		Custom
	-->
	<category name="HomeKit32" colour="120">
		<block type="connect"></block>
		<block type="disconnect"></block>
		<block type="yellow_led_on"></block>
		<block type="yellow_led_off"></block>
		<block type="yellow_led"></block>
		<block type="delay"></block>
		<block type="dht11_sensor"></block>
		<block type="open_door"></block>
	</category>

	<!--
		Standard
	-->

	<category name="Program Flow" colour="0">
		<block type="start_block"></block>
		<block type="stop_block"></block>
		<block type="comment_block"></block>
		<block type="log_block"></block>
		<block type="text_literal"></block>
	</category>

	<category name="Loops" colour="120">
		<block type="repeat_loop">
			<value name="TIMES">
				<block type="math_number"><field name="NUM">5</field></block>
			</value>
			<statement name="DO"></statement>
		</block>
		<block type="while_loop"></block>
	</category>

	<category name="Logic" colour="210">
		<block type="logic_boolean"></block>
		<block type="logic_compare"></block>
		<block type="logic_operation"></block>
		<block type="logic_negate"></block>
		<block type="logic_if"></block>
		<block type="logic_if_else"></block>
		<block type="logic_else_if"></block>
	</category>
	
	<category name="Math" colour="230">
		<block type="math_number"><field name="NUM">0</field></block>
	</category>

	<!--
		custom="VARIABLE" tells Blockly to automatically include:
			A “Create Variable” button.
			All variables_set and variables_get blocks for all variables in the workspace.
			No need a separate “Variables Custom” category with explicit variables_set/variables_get blocks, unless you want two separate categories for cosmetic reasons.
	-->
	<category name="Variables" custom="VARIABLE"></category>

</xml>

<!-- Blockly will be injected here -->
<div id="blocklyDiv"></div>

<!--
	HTML buttons replaced by B4X buttons.
  -->
<div id="buttons">
  <button id="btnRun">Run</button>
<!--
  <button id="btnSaveWorkspace">Save Workspace</button>
  <button id="btnLoadWorkspace">Load Workspace</button>
  -->
</div>

<!-- 
	New variable dialog instead HTML confirm dialogAdd inside <body> 
-->
<div id="variableDialog" style="
    display:none;
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%);
    background:white;
    border: 2px solid #444;
    padding: 20px;
    z-index:1000;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
">
    <label for="varNameInput">Variable name:</label>
    <input id="varNameInput" type="text" />
    <button id="btnVarOK">OK</button>
    <button id="btnVarCancel">Cancel</button>
</div>

<div id="blocklyDiv"></div>

<!-- 
	LOAD JS AFTER HTML, IMPORTANT! 
-->

<!-- Your block definitions -->
<script src="blockly_custom_blocks.js"></script>
<script src="blockly_standard_blocks.js"></script>
<!-- Generators & runtime helpers -->
<script src="blockly_generators.js"></script>
<script src="blockly_device_states.js"></script>

<!-- Your app script (must handle run button etc.) -->
<!-- blockly_app.js should implement run button that calls runWorkspaceBlocks() -->
<script src="blockly_app.js"></script>

</body>
</html>
